<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>王智慧专属 - 多人共享</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#EC4899',
                        accent: '#8B5CF6',
                        neutral: '#1F2937',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .text-gradient {
                background-clip: text;
                -webkit-background-clip: text;
                color: transparent;
            }
            .input-focus {
                @apply focus:ring-2 focus:ring-primary/50 focus:border-primary focus:outline-none;
            }
            .card-hover {
                @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-1;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen font-sans">
    <!-- 页面容器 -->
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 标题部分 -->
        <header class="text-center my-12 animate-fade-in">
            <h1 class="text-[clamp(2.5rem,8vw,5rem)] font-bold bg-gradient-to-r from-primary to-accent text-gradient text-shadow tracking-wider">
                王智慧专属
            </h1>
            <p class="text-gray-600 mt-4 text-lg md:text-xl">大家的想法和愿望，所有人都能看见</p>
        </header>

        <!-- 主内容区 -->
        <main class="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-12">
            <form id="wishForm" class="space-y-6">
                <!-- 你的昵称 -->
                <div class="card-hover bg-gray-50 rounded-xl p-5">
                    <label for="nickname" class="block mb-2 text-lg font-medium text-gray-700 flex items-center">
                        <i class="fa fa-user text-neutral mr-3"></i>你的昵称
                    </label>
                    <input 
                        type="text" 
                        id="nickname" 
                        name="nickname" 
                        placeholder="请输入你的昵称，让大家知道是谁添加的..." 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus transition-all"
                        required
                    >
                </div>
                
                <!-- 想吃的东西 -->
                <div class="card-hover bg-blue-50 rounded-xl p-5">
                    <label for="food" class="block mb-2 text-lg font-medium text-gray-700 flex items-center">
                        <i class="fa fa-cutlery text-primary mr-3"></i>想吃的东西
                    </label>
                    <input 
                        type="text" 
                        id="food" 
                        name="food" 
                        placeholder="例如：火锅、冰淇淋、妈妈做的红烧肉..." 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus transition-all"
                    >
                </div>

                <!-- 想要的东西 -->
                <div class="card-hover bg-pink-50 rounded-xl p-5">
                    <label for="thing" class="block mb-2 text-lg font-medium text-gray-700 flex items-center">
                        <i class="fa fa-gift text-secondary mr-3"></i>想要的东西
                    </label>
                    <input 
                        type="text" 
                        id="thing" 
                        name="thing" 
                        placeholder="例如：一本好书、新鞋子、一次旅行..." 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus transition-all"
                    >
                </div>

                <!-- 想做的事 -->
                <div class="card-hover bg-purple-50 rounded-xl p-5">
                    <label for="activity" class="block mb-2 text-lg font-medium text-gray-700 flex items-center">
                        <i class="fa fa-calendar-check-o text-accent mr-3"></i>想做的事
                    </label>
                    <input 
                        type="text" 
                        id="activity" 
                        name="activity" 
                        placeholder="例如：学一门新技能、看一场电影、和朋友聚会..." 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus transition-all"
                    >
                </div>

                <!-- 提交按钮 -->
                <div class="text-center pt-4">
                    <button 
                        type="submit" 
                        class="bg-gradient-to-r from-primary to-accent text-white font-bold py-3 px-8 rounded-full text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2"
                    >
                        <i class="fa fa-paper-plane mr-2"></i>分享我的想法
                    </button>
                </div>
            </form>
        </main>

        <!-- 加载状态 -->
        <div id="loading" class="text-center py-8 hidden">
            <i class="fa fa-circle-o-notch fa-spin text-primary text-2xl"></i>
            <p class="mt-2 text-gray-600">加载中...</p>
        </div>

        <!-- 错误提示 -->
        <div id="error" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 hidden">
            <div class="flex items-center">
                <i class="fa fa-exclamation-circle text-red-500 mr-2"></i>
                <p class="text-red-700" id="errorMessage">加载失败，请稍后重试</p>
            </div>
        </div>

        <!-- 历史记录区域 -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-center mb-6 text-neutral">
                <i class="fa fa-comments text-primary mr-2"></i>大家的想法
            </h2>
            <div id="historyContainer" class="space-y-4 max-h-[500px] overflow-y-auto p-4 bg-white rounded-2xl shadow-md">
                <!-- 历史记录将通过JavaScript动态添加 -->
                <p class="text-gray-500 text-center italic" id="emptyHistory">暂无记录，快来添加第一条想法吧！</p>
            </div>
        </section>

        <!-- 页脚 -->
        <footer class="text-center text-gray-500 text-sm py-6">
            <p>王智慧专属 &copy; 2023 - 多人共享版</p>
        </footer>
    </div>

    <!-- 提示弹窗 -->
    <div id="toast" class="fixed bottom-6 right-6 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-500 flex items-center">
        <i class="mr-2"></i>
        <span></span>
    </div>

    <script>
        // Firebase 配置 - 使用你提供的配置信息
        const firebaseConfig = {
            apiKey: "AIzaSyD1nHzAMeJdk8MqBzGxx7IppizTsfP-Fn0",
            authDomain: "wangzhihui-cfcbe.firebaseapp.com",
            projectId: "wangzhihui-cfcbe",
            storageBucket: "wangzhihui-cfcbe.firebasestorage.app",
            messagingSenderId: "227941528706",
            appId: "1:227941528706:web:996dc50fb529a14834309b",
            measurementId: "G-HT4HTMNCXE"
        };

        // 初始化Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);
        const analytics = firebase.analytics(app);

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('wishForm');
            const historyContainer = document.getElementById('historyContainer');
            const emptyHistory = document.getElementById('emptyHistory');
            const toast = document.getElementById('toast');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const errorMessage = document.getElementById('errorMessage');
            
            // 加载数据
            loadData();
            
            // 监听数据变化，实时更新
            listenForDataChanges();
            
            // 表单提交事件
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // 获取表单数据
                const nickname = document.getElementById('nickname').value.trim();
                const food = document.getElementById('food').value.trim();
                const thing = document.getElementById('thing').value.trim();
                const activity = document.getElementById('activity').value.trim();
                
                // 验证
                if (!nickname) {
                    showToast('请输入你的昵称', 'error');
                    return;
                }
                
                // 验证至少填写一项内容
                if (!food && !thing && !activity) {
                    showToast('请至少填写一项内容', 'error');
                    return;
                }
                
                // 创建记录对象
                const record = {
                    nickname,
                    food,
                    thing,
                    activity,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    date: new Date().toLocaleString()
                };
                
                // 保存记录到Firebase
                saveRecord(record);
                
                // 显示成功提示
                showToast('分享成功！所有人都能看到你的想法了', 'success');
                
                // 重置表单（保留昵称）
                document.getElementById('food').value = '';
                document.getElementById('thing').value = '';
                document.getElementById('activity').value = '';
            });
            
            // 保存记录到Firebase
            function saveRecord(record) {
                db.collection("wishes").add(record)
                    .then(() => {
                        console.log("记录已成功添加到数据库");
                    })
                    .catch((error) => {
                        console.error("添加记录时出错：", error);
                        showToast(`保存失败: ${error.message}`, 'error');
                    });
            }
            
            // 加载数据
            function loadData() {
                showLoading();
                hideError();
                
                db.collection("wishes")
                  .orderBy("timestamp", "desc")
                  .limit(50)
                  .get()
                  .then((querySnapshot) => {
                      hideLoading();
                      displayRecords(querySnapshot.docs);
                  })
                  .catch((error) => {
                      hideLoading();
                      showError(`加载数据失败: ${error.message}`);
                      console.error("获取数据时出错：", error);
                  });
            }
            
            // 监听数据变化
            function listenForDataChanges() {
                db.collection("wishes")
                  .orderBy("timestamp", "desc")
                  .limit(50)
                  .onSnapshot((querySnapshot) => {
                      displayRecords(querySnapshot.docs);
                  }, (error) => {
                      showError(`实时更新失败: ${error.message}`);
                      console.error("监听数据变化时出错：", error);
                  });
            }
            
            // 显示记录
            function displayRecords(docs) {
                // 清空现有内容
                historyContainer.innerHTML = '';
                historyContainer.appendChild(emptyHistory);
                
                // 检查是否有记录
                if (docs.length === 0) {
                    emptyHistory.style.display = 'block';
                    return;
                }
                
                // 隐藏空记录提示
                emptyHistory.style.display = 'none';
                
                // 添加记录到页面
                docs.forEach(doc => {
                    const record = doc.data();
                    record.id = doc.id;
                    const recordElement = createRecordElement(record);
                    historyContainer.appendChild(recordElement);
                });
            }
            
            // 创建记录元素
            function createRecordElement(record) {
                const div = document.createElement('div');
                div.className = 'border border-gray-100 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow bg-gray-50';
                div.setAttribute('data-id', record.id);
                
                let content = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="font-semibold text-neutral">${record.nickname}</div>
                        <div class="text-xs text-gray-500">${record.date || '刚刚'}</div>
                    </div>
                `;
                
                if (record.food) {
                    content += `
                        <div class="flex items-center mb-1">
                            <i class="fa fa-cutlery text-primary text-sm mr-2"></i>
                            <span>想吃：${record.food}</span>
                        </div>
                    `;
                }
                
                if (record.thing) {
                    content += `
                        <div class="flex items-center mb-1">
                            <i class="fa fa-gift text-secondary text-sm mr-2"></i>
                            <span>想要：${record.thing}</span>
                        </div>
                    `;
                }
                
                if (record.activity) {
                    content += `
                        <div class="flex items-center">
                            <i class="fa fa-calendar-check-o text-accent text-sm mr-2"></i>
                            <span>想做：${record.activity}</span>
                        </div>
                    `;
                }
                
                div.innerHTML = content;
                return div;
            }
            
            // 显示提示
            function showToast(message, type = 'info') {
                const icon = toast.querySelector('i');
                const text = toast.querySelector('span');
                
                // 设置提示内容
                text.textContent = message;
                
                // 设置图标和样式
                icon.className = '';
                toast.className = 'fixed bottom-6 right-6 px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-500 flex items-center';
                
                switch (type) {
                    case 'success':
                        icon.className = 'fa fa-check-circle mr-2 text-green-500';
                        toast.classList.add('bg-green-100', 'text-green-800');
                        break;
                    case 'error':
                        icon.className = 'fa fa-exclamation-circle mr-2 text-red-500';
                        toast.classList.add('bg-red-100', 'text-red-800');
                        break;
                    case 'info':
                    default:
                        icon.className = 'fa fa-info-circle mr-2 text-blue-500';
                        toast.classList.add('bg-blue-100', 'text-blue-800');
                }
                
                // 显示提示
                setTimeout(() => {
                    toast.classList.remove('translate-y-20', 'opacity-0');
                    toast.classList.add('translate-y-0', 'opacity-100');
                }, 10);
                
                // 3秒后隐藏提示
                setTimeout(() => {
                    toast.classList.remove('translate-y-0', 'opacity-100');
                    toast.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            }
            
            // 加载状态控制
            function showLoading() {
                loading.classList.remove('hidden');
            }
            
            function hideLoading() {
                loading.classList.add('hidden');
            }
            
            // 错误提示控制
            function showError(message) {
                errorMessage.textContent = message;
                error.classList.remove('hidden');
            }
            
            function hideError() {
                error.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
